import discord
import json

# Dictionary mapping Pokémon names to their corresponding links
with open('guides.json', 'r', encoding='utf-8') as f:
    pokemon_links = json.loads(f.read())

# Response for the !squad command
squad_info = """
Hi there! Here is information about our squads. We currently have two.

Squad name: **Sector**
Squad ID: **#Y7Q2NH5Q**
Leader: **Cyber**

Squad Name: **Sector・B**
Squad ID: **#NK1EE0P6**
Leader: **Hikari**

Please send a request & message the squad leader to join.
"""
# Response for the !help command
help = """
Hi there! See the list of bot commands you can use:

**!help**
General info about the bot and commands.
**!squad**
Information & squad IDs for our squads.
**!guide <pokemon name>**
I will bring up a guide for a Pokémon you want.

More commands coming soon!
"""

# Define your intents
intents = discord.Intents.default()
intents.message_content = True

# Initialize Discord client with intents
client = discord.Client(intents = intents)

_COMMANDS = {}


def bot_command(cmd_name):
    def cmd_wrapper(f):
        _COMMANDS[cmd_name.lower()] = f
        return f

    return cmd_wrapper


@bot_command("guide")
async def cmd_guide(message, pokemon_name=None):
    if pokemon_name:
        pokemon_name = pokemon_name.lower()
        # Check if the Pokémon name is in the dictionary
        if pokemon_name in pokemon_links:
            # Send the corresponding link along with a message
            _ = pokemon_links[pokemon_name]
            await message.channel.send(f"Here is a guide for {_['name']}. I hope you find it helpful!\n{_['url']}")
        else:
            # If the Pokémon name is not found, send a message indicating so
            await message.channel.send("Sorry, I couldn't find a guide for that Pokémon.")
    else:
        await message.channel.send("Usage: !guide <pokemon name>")


@bot_command("squad")
async def cmd_squad(message, *args):
    embed = discord.Embed(title="Squad Information", description=squad_info, color=0xBA8EBF)
    await message.channel.send(embed=embed)

@bot_command("help")
async def cmd_help(message, *args):
    embed = discord.Embed(title="Helpful Information", description=help, color=0xBA8EBF)
    await message.channel.send(embed=embed)

@client.event
async def on_ready():
    print('Logged in as {0.user}'.format(client))
    # Get the #general channel
    general_channel = discord.utils.get(client.get_all_channels(), name='general')
    if general_channel:
        await general_channel.send("I am back online! Try one of my commands!")


@client.event
async def on_message(message):
    if message.author == client.user:
        return

    if not message.content.startswith('!'):
        return

    cmd, *cont = message.content.split(' ', 1)
    cmd = cmd[1:].lower()
    if cmd in _COMMANDS:
        await _COMMANDS[cmd](message, *cont)


# Run the bot with its token
client.run('TOKEN GOES HERE')
